<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pickleball Tournament</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Pickleball Tournament</h1>
        <nav>
            <ul>
                <li><a href="register.html">Register</a></li>
                <li><a href="index.html">Tournament</a></li>
                <li><a href="ranking.html">Ranking</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section>
            <h2>Current Tournament Bracket</h2>
            <div id="tournamentBracket">
                <!-- Турнирная сетка будет отображаться здесь -->
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Pickleball Tournament</p>
    </footer>

    <script>
        // Имена предустановленных участников
        const predefinedPlayers = [
            'Alice', 'Bob', 'Charlie', 'Dave', 'Eve', 'Frank',
            'Grace', 'Hank', 'Ivy', 'Jack', 'Karen'
        ];

        // Получаем список зарегистрированных участников из localStorage
        let participants = JSON.parse(localStorage.getItem('participants')) || [];

        // Если зарегистрированных игроков больше, чем один, добавляем их к списку предустановленных участников
        if (participants.length > 0) {
            predefinedPlayers.push(participants[participants.length - 1].name);
        }

        // Получаем текущий раунд из localStorage
        let currentRound = JSON.parse(localStorage.getItem('currentRound')) || 1;
        let matchResults = JSON.parse(localStorage.getItem('matchResults')) || {};

        // Функция для обновления результатов и перехода на следующий раунд
        function saveResultsAndProceed() {
            const scores = document.querySelectorAll('.score-input');
            scores.forEach((input, index) => {
                const matchId = `round${currentRound}_match${index}`;
                matchResults[matchId] = input.value;
            });
            localStorage.setItem('matchResults', JSON.stringify(matchResults));
            
            // Переходим к следующему раунду, если текущий раунд завершен
            currentRound++;
            localStorage.setItem('currentRound', JSON.stringify(currentRound));
            renderBracket();
        }

        // Функция отображения турнирной сетки
        function renderBracket() {
            const bracket = document.getElementById('tournamentBracket');
            bracket.innerHTML = '';

            // Количество участников на текущем этапе
            let players = predefinedPlayers;

            if (currentRound > 1) {
                players = [];
                // Добавляем победителей предыдущих матчей в список участников текущего раунда
                for (let i = 0; i < 6; i++) {
                    const matchId = `round${currentRound-1}_match${i}`;
                    const score = matchResults[matchId];
                    const winner = i % 2 === 0 ? predefinedPlayers[i] : predefinedPlayers[i + 1];
                    players.push(winner);
                }
            }

            const matches = [];
            const numMatches = players.length / 2;

            for (let i = 0; i < numMatches; i++) {
                const player1 = players[i * 2];
                const player2 = players[i * 2 + 1];
                const matchId = `round${currentRound}_match${i}`;
                const score = matchResults[matchId] || '';

                matches.push(`
                    <div class="match">
                        ${player1} vs ${player2}
                        <input class="score-input" type="text" placeholder="Enter score" value="${score}">
                    </div>
                `);
            }

            bracket.innerHTML = matches.join('') + `<button onclick="saveResultsAndProceed()">Next Round</button>`;
        }

        // Отображаем турнирную сетку при загрузке страницы
        renderBracket();
    </script>
</body>
</html>
